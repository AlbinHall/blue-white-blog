
{% extends 'base.html' %}
{% block content %}
{% load crispy_forms_tags %}

<h2>{{ discussion.title }}</h2>
<p>{{ discussion.description }}</p>
<p>Author: {{ discussion.author }}</p>
<p>Date Created: {{ discussion.date_created }}</p>

<h3>Comments</h3>
{% for comment in comments %}
<div class="comment">
    <p>{{ comment.text }}</p>
    <p>Author: {{ comment.author }}</p>
    <p>Date Created: {{ comment.date_created }}</p>
    
    <!-- Collapse to show replies if there are any -->
    {% if comment.replies.all %}
    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse-{{ comment.id }}">
        Replies
    </button>
    <div id="collapse-{{ comment.id }}" class="collapse">
        {% for reply in comment.replies.all %}
        <div class="reply">
            <p>{{ reply.text }}</p>
            <p>Author: {{ reply.author }}</p>
            <p>Date Created: {{ reply.date_created }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Form to submit a reply -->
    <form method="post" class="reply-form">
        {% csrf_token %}
        {{ reply_form.text }}
        <input type="hidden" name="parent_id" value="{{ comment.id }}">
        <input type="submit" value="Reply">
    </form>
</div>
{% endfor %}

<h3>Add a Comment</h3>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Submit">
</form>
<a href="{% url 'discussion_list' %}">Back to discussion list</a>
{% endblock %}


{% for comment in comments %}
    <div class="comment">
        <p>{{ comment.text }}</p>
        <p>Author: {{ comment.author }}</p>
        <p>Date Created: {{ comment.date_created }}</p>

        {% if comment.children.exists %}
            <button class="btn btn-primary" data-toggle="collapse" data-target="#{{ comment.id }}">Show Replies</button>
            <div id="{{ comment.id }}" class="collapse">
                {% for reply in comment.children.all %}
                    <div class="reply">
                        <p>{{ reply.text }}</p>
                        <p>Author: {{ reply.author }}</p>
                        <p>Date Created: {{ reply.date_created }}</p>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endfor %}
